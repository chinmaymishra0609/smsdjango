<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Chat System</title>
    </head>
	<body>
        <h1>Group Name: {{group_name}} </h1>
        <textarea name="chat-log" id="chat-log" rows="20" cols="100">
            {% for chat in chats %}
                {{ chat.content }}
            {% endfor %}
        </textarea><br/>
        <input type="text" name="chat-message-input" id="chat-message-input" size="100"/><br/>
        <input type="button" name="chat-message-submit" id="chat-message-submit" value="Send"/>
        {{group_name|json_script:"group_name"}}

        <script type="text/javascript">
            const groupName = JSON.parse(document.getElementById('group_name').textContent);

            {% comment %} var ws = new WebSocket("ws://" + window.location.host + "/ws/ac/" + groupName + "/"); {% endcomment %}
            {% comment %} var ws = new WebSocket("ws://" + window.location.host + "/ws/sc/" + groupName + "/"); {% endcomment %}
            {% comment %} var ws = new WebSocket("ws://" + window.location.host + "/ws/wsac/" + groupName + "/"); {% endcomment %}
            {% comment %} var ws = new WebSocket("ws://" + window.location.host + "/ws/wsac/" + groupName + "/"); {% endcomment %}
            {% comment %} var ws = new WebSocket("ws://" + window.location.host + "/ws/jwssc/" + groupName + "/"); {% endcomment %}
            var ws = new WebSocket("ws://" + window.location.host + "/ws/jwsac/" + groupName + "/");

            ws.onopen = function(event){
                console.log("WebSocket is connected.");
            }

            ws.onmessage = function(event){
                console.log(event);
                var data = JSON.parse(event.data);
                var message = data["message"];
                var user = data["user"];
                document.querySelector("#chat-log").value += `${user}:${message}\n`;
            };

            ws.onerror = function(event){
                console.log("WebSocket error observed:", event);
            };

            ws.onclose = function(event){
                console.log("WebSocket is closed.");
            };

            document.getElementById("chat-message-submit").onclick = function(event){
                var messageInputDom = document.getElementById("chat-message-input");
                var message = messageInputDom.value;
                ws.send(JSON.stringify({"message": message}));
                messageInputDom.value = "";
            };

            {% comment %} ws.addEventListener("open", function(event){
                console.log("WebSocket connection established.");
            });

            ws.addEventListener("message", function(event){
                var data = JSON.parse(event.data);
                var message = data["message"];
                document.querySelector("#chat-log").value += message + "\n";
            });

            ws.addEventListener("error", function(event){
                console.log("WebSocket error observed:", event);
            });

            ws.addEventListener("close", function(event){
                console.log("WebSocket connection closed unexpectedly.");
            }); {% endcomment %}
        </script>
	</body>
</html>